<div class="forgot-password-container">
  <h2 mat-dialog-title>Reset Password</h2>
  
  <mat-dialog-content>
    <!-- Step 1: Username and Email -->
    <div *ngIf="step === 1">
      <p>Please enter your username and email to receive an OTP.</p>
      <form class="forgot-password-form" (ngSubmit)="onNextStep1()">
        <mat-form-field appearance="fill">
          <mat-label>Username</mat-label>
          <input matInput [(ngModel)]="username" name="username" required>
          <mat-icon matSuffix>person</mat-icon>
        </mat-form-field>
        
        <mat-form-field appearance="fill">
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="email" name="email" type="email" required>
          <mat-icon matSuffix>email</mat-icon>
        </mat-form-field>
        
        <div class="error-container">
          <p *ngIf="error" class="error">{{ error }}</p>
        </div>
        
        <mat-dialog-actions>
          <button mat-button type="button" (click)="onCancel()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading">
            <span *ngIf="!loading">Next</span>
            <span *ngIf="loading" class="spinner"></span>
          </button>
        </mat-dialog-actions>
      </form>
    </div>
    
    <!-- Step 2: OTP Verification -->
    <div *ngIf="step === 2">
      <p>An OTP has been sent to your email. Please enter it below.</p>
      <form class="forgot-password-form" (ngSubmit)="onNextStep2()">
        <mat-form-field appearance="fill">
          <mat-label>OTP</mat-label>
          <input matInput [(ngModel)]="otp" name="otp" required>
          <mat-icon matSuffix>vpn_key</mat-icon>
        </mat-form-field>
        
        <div class="error-container">
          <p *ngIf="error" class="error">{{ error }}</p>
        </div>
        
        <mat-dialog-actions>
          <button mat-button type="button" (click)="onCancel()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading">
            <span *ngIf="!loading">Verify</span>
            <span *ngIf="loading" class="spinner"></span>
          </button>
        </mat-dialog-actions>
      </form>
    </div>
    
    <!-- Step 3: Reset Password -->
    <div *ngIf="step === 3">
      <p>Enter your new password.</p>
      <form class="forgot-password-form" (ngSubmit)="onResetPassword()">
        <mat-form-field appearance="fill">
          <mat-label>New Password</mat-label>
          <input matInput [(ngModel)]="newPassword" name="newPassword" type="password" required>
          <mat-icon matSuffix>lock</mat-icon>
        </mat-form-field>
        
        <div class="error-container">
          <p *ngIf="error" class="error">{{ error }}</p>
        </div>
        
        <mat-dialog-actions>
          <button mat-button type="button" (click)="onCancel()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading">
            <span *ngIf="!loading">Reset Password</span>
            <span *ngIf="loading" class="spinner"></span>
          </button>
        </mat-dialog-actions>
      </form>
    </div>
  </mat-dialog-content>
</div>